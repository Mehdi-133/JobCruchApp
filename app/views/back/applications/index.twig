<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Applications Management - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: #6366F1;
            --color-primary-hover: #4F46E5;
            --color-primary-light: #EEF2FF;
            --color-success: #059669;
            --color-success-light: #ECFDF5;
            --color-danger: #DC2626;
            --color-danger-light: #FEF2F2;
            --color-warning: #F59E0B;
            --color-warning-light: #FEF3C7;
            --color-neutral-50: #FAFAFA;
            --color-neutral-100: #F5F5F5;
            --color-neutral-200: #E5E5E5;
            --color-neutral-300: #D4D4D4;
            --color-neutral-400: #A3A3A3;
            --color-neutral-500: #737373;
            --color-neutral-600: #525252;
            --color-neutral-700: #404040;
            --color-neutral-800: #262626;
            --color-neutral-900: #171717;
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-2xl: 48px;
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 14px;
            --radius-xl: 18px;
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.04);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05), 0 2px 4px rgba(0, 0, 0, 0.03);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.08), 0 4px 6px rgba(0, 0, 0, 0.04);
            --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.12), 0 10px 10px rgba(0, 0, 0, 0.04);
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-smooth: 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--color-neutral-900);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .bg-animation span {
            position: absolute;
            display: block;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            animation: move 25s linear infinite;
            bottom: -150px;
        }

        .bg-animation span:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
        .bg-animation span:nth-child(2) { left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
        .bg-animation span:nth-child(3) { left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
        .bg-animation span:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
        .bg-animation span:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 0s; }
        .bg-animation span:nth-child(6) { left: 75%; width: 110px; height: 110px; animation-delay: 3s; }
        .bg-animation span:nth-child(7) { left: 35%; width: 150px; height: 150px; animation-delay: 7s; }
        .bg-animation span:nth-child(8) { left: 50%; width: 25px; height: 25px; animation-delay: 15s; animation-duration: 45s; }
        .bg-animation span:nth-child(9) { left: 20%; width: 15px; height: 15px; animation-delay: 2s; animation-duration: 35s; }
        .bg-animation span:nth-child(10) { left: 85%; width: 150px; height: 150px; animation-delay: 0s; animation-duration: 11s; }

        @keyframes move {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; border-radius: 0; }
            100% { transform: translateY(-1000px) rotate(720deg); opacity: 0; border-radius: 50%; }
        }

        .page-container {
            max-width: 1440px;
            margin: 0 auto;
            padding: var(--spacing-2xl) var(--spacing-lg);
            position: relative;
            z-index: 1;
        }

        .page-header {
            margin-bottom: var(--spacing-xl);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: var(--spacing-lg);
        }

        .header-title-group {
            flex: 1;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -0.02em;
            color: white;
            margin-bottom: var(--spacing-xs);
        }

        .page-subtitle {
            font-size: 15px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 400;
            line-height: 1.5;
        }

        .table-container {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--color-neutral-200);
        }

        .table-header {
            padding: var(--spacing-lg);
            background: linear-gradient(135deg, #F8F9FC 0%, #FAFBFF 100%);
            border-bottom: 1px solid var(--color-neutral-200);
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-neutral-900);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .table-title i {
            color: var(--color-primary);
        }

        .applications-table {
            width: 100%;
            border-collapse: collapse;
        }

        .applications-table th {
            background: var(--color-neutral-50);
            padding: var(--spacing-md) var(--spacing-lg);
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            color: var(--color-neutral-700);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--color-neutral-200);
        }

        .applications-table td {
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--color-neutral-100);
            font-size: 14px;
            color: var(--color-neutral-600);
        }

        .applications-table .application-row:hover {
            background: var(--color-neutral-50);
            cursor: pointer;
        }

        .student-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .student-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--color-primary) 0%, #8B5CF6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .student-details h4 {
            font-weight: 600;
            color: var(--color-neutral-900);
            margin-bottom: 2px;
        }

        .student-details p {
            font-size: 12px;
            color: var(--color-neutral-500);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-pending {
            background: var(--color-warning-light);
            color: var(--color-warning);
        }

        .status-accepted {
            background: var(--color-success-light);
            color: var(--color-success);
        }

        .status-rejected {
            background: var(--color-danger-light);
            color: var(--color-danger);
        }

        .job-info {
            font-weight: 500;
            color: var(--color-neutral-900);
        }

        .company-name {
            font-size: 12px;
            color: var(--color-neutral-500);
            margin-top: 2px;
        }

        .date-info {
            color: var(--color-neutral-600);
            font-size: 13px;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-right: 4px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .accept-btn {
            background: var(--color-success-light);
            color: var(--color-success);
        }

        .accept-btn:hover {
            background: var(--color-success);
            color: white;
        }

        .reject-btn {
            background: var(--color-danger-light);
            color: var(--color-danger);
        }

        .reset-btn {
            background: var(--color-warning-light);
            color: var(--color-warning);
        }

        .reset-btn:hover {
            background: var(--color-warning);
            color: white;
        }

        .action-disabled {
            font-size: 12px;
            color: var(--color-neutral-500);
            font-style: italic;
        }

        .empty-state {
            background: white;
            border: 2px dashed var(--color-neutral-300);
            border-radius: var(--radius-xl);
            padding: var(--spacing-2xl) var(--spacing-xl);
            text-align: center;
            max-width: 480px;
            margin: var(--spacing-2xl) auto;
        }

        .empty-state-icon {
            width: 88px;
            height: 88px;
            margin: 0 auto var(--spacing-lg);
            background: linear-gradient(135deg, var(--color-neutral-100) 0%, var(--color-neutral-50) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-neutral-400);
            font-size: 36px;
        }

        .empty-state h2 {
            font-size: 22px;
            font-weight: 600;
            color: var(--color-neutral-900);
            margin-bottom: var(--spacing-sm);
        }

        .empty-state p {
            font-size: 15px;
            color: var(--color-neutral-500);
            line-height: 1.6;
        }

        /* Modern Modal Styles - FIXED SCROLL */
        .modal {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            outline: 0;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn var(--transition-base);
            padding: 20px;
            backdrop-filter: blur(4px);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            position: relative;
            background-color: white;
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 900px;
            margin: 2rem auto;
            box-shadow: var(--shadow-xl);
            animation: slideUp var(--transition-smooth);
            overflow: hidden;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: var(--spacing-xl) var(--spacing-xl) var(--spacing-lg);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
            flex-shrink: 0;
        }

        .modal-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #6366F1, #8B5CF6, #EC4899);
        }

        .modal-header-content {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-lg);
        }

        .modal-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 28px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            flex-shrink: 0;
        }

        .modal-header-text {
            flex: 1;
        }

        .modal-header h3 {
            font-size: 24px;
            font-weight: 700;
            margin: 0 0 4px 0;
            letter-spacing: -0.01em;
        }

        .modal-header p {
            font-size: 15px;
            color: rgba(255, 255, 255, 0.9);
            margin: 0 0 12px 0;
        }

        .modal-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .modal-status i {
            font-size: 10px;
        }

        .modal-body {
            padding: var(--spacing-xl);
            overflow-y: auto;
            flex: 1;
            max-height: calc(90vh - 200px); /* Fixed height for scrollable area */
        }

        .modal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .modal-section {
            background: var(--color-neutral-50);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid var(--color-neutral-200);
            overflow: visible; /* Changed from hidden */
        }

        .modal-section h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-neutral-700);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 0 0 var(--spacing-md) 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-section h4 i {
            color: var(--color-primary);
            font-size: 13px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 8px 12px;
            align-items: start;
        }

        .info-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--color-neutral-600);
        }

        .info-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--color-neutral-900);
            word-break: break-word;
        }

        .info-value a {
            color: var(--color-primary);
            text-decoration: none;
            font-weight: 600;
            transition: color var(--transition-fast);
        }

        .info-value a:hover {
            color: var(--color-primary-hover);
            text-decoration: underline;
        }

        .info-value a i {
            margin-left: 4px;
            font-size: 11px;
        }

        .modal-actions {
            display: flex;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--color-neutral-200);
            flex-shrink: 0;
        }

        .modal-btn {
            flex: 1;
            padding: var(--spacing-md);
            border: none;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .modal-btn-accept {
            background: var(--color-success);
            color: white;
        }

        .modal-btn-accept:hover {
            background: #047857;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }

        .modal-btn-reject {
            background: var(--color-danger);
            color: white;
        }

        .modal-btn-reject:hover {
            background: #B91C1C;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        .modal-btn-close {
            background: var(--color-neutral-200);
            color: var(--color-neutral-700);
        }

        .modal-btn-close:hover {
            background: var(--color-neutral-300);
            transform: translateY(-1px);
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all var(--transition-fast);
            z-index: 2;
        }

        .close-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .badge-group {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 4px;
        }

        .info-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: var(--color-primary-light);
            color: var(--color-primary);
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
        }

        .info-badge i {
            font-size: 9px;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 24px;
            margin-top: var(--spacing-md);
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 7px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--color-neutral-300);
        }

        .timeline-item {
            position: relative;
            margin-bottom: var(--spacing-lg);
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 4px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--color-primary);
            border: 2px solid white;
            box-shadow: 0 0 0 2px var(--color-primary);
        }

        .timeline-date {
            font-size: 11px;
            color: var(--color-neutral-500);
            font-weight: 500;
            margin-bottom: 2px;
        }

        .timeline-content {
            font-size: 13px;
            color: var(--color-neutral-700);
        }

        /* Motivation Letter Styles */
        .motivation-letter {
            background: white;
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            border: 1px solid var(--color-neutral-200);
            font-size: 14px;
            line-height: 1.6;
            color: var(--color-neutral-700);
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .motivation-letter h5 {
            font-size: 13px;
            font-weight: 600;
            color: var(--color-neutral-700);
            margin-bottom: var(--spacing-sm);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Scrollbar Styling */
        .modal-body::-webkit-scrollbar,
        .motivation-letter::-webkit-scrollbar {
            width: 8px;
        }

        .modal-body::-webkit-scrollbar-track,
        .motivation-letter::-webkit-scrollbar-track {
            background: var(--color-neutral-100);
            border-radius: 4px;
        }

        .modal-body::-webkit-scrollbar-thumb,
        .motivation-letter::-webkit-scrollbar-thumb {
            background: var(--color-neutral-300);
            border-radius: 4px;
        }

        .modal-body::-webkit-scrollbar-thumb:hover,
        .motivation-letter::-webkit-scrollbar-thumb:hover {
            background: var(--color-neutral-400);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-container {
                padding: var(--spacing-lg) var(--spacing-md);
            }

            .page-title {
                font-size: 26px;
            }

            .applications-table {
                font-size: 12px;
            }

            .applications-table th,
            .applications-table td {
                padding: var(--spacing-sm);
            }

            .modal {
                padding: 10px;
            }

            .modal-content {
                margin: 1rem auto;
                max-height: 95vh;
            }

            .modal-body {
                max-height: calc(95vh - 180px);
                padding: var(--spacing-lg);
            }

            .modal-header-content {
                flex-direction: column;
                text-align: center;
                gap: var(--spacing-md);
            }

            .modal-avatar {
                width: 60px;
                height: 60px;
                font-size: 22px;
                margin: 0 auto;
            }

            .modal-header h3 {
                font-size: 20px;
            }

            .modal-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-lg);
            }

            .info-grid {
                grid-template-columns: 1fr;
                gap: 4px;
            }

            .modal-actions {
                flex-direction: column;
            }

            .close-button {
                top: 12px;
                right: 12px;
                width: 32px;
                height: 32px;
                font-size: 18px;
            }

            .motivation-letter {
                max-height: 250px;
                padding: var(--spacing-md);
            }
        }

        @media (max-width: 480px) {
            .modal-header {
                padding: var(--spacing-lg);
            }

            .modal-body {
                padding: var(--spacing-md);
            }

            .modal-section {
                padding: var(--spacing-md);
            }

            .motivation-letter {
                max-height: 200px;
            }
        }
    </style>
</head>
<body>
<div class="bg-animation">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
</div>

{% include 'back/assets/nav.twig' with {'current_page': 'applications'} %}

<div class="page-container">
    <header class="page-header">
        <div class="header-content">
            <div class="header-title-group">
                <h1 class="page-title">Applications</h1>
                <p class="page-subtitle">View and manage student job applications</p>
            </div>
        </div>
    </header>

    {% if applications and applications|length > 0 %}
        <div class="table-container">
            <div class="table-header">
                <h2 class="table-title">
                    <i class="fas fa-file-alt"></i>
                    Student Applications
                </h2>
            </div>

            <table class="applications-table">
                <thead>
                <tr>
                    <th>Student</th>
                    <th>Job Position</th>
                    <th>Company</th>
                    <th>Applied Date</th>
                    <th>Status</th>
                    <th>Speciality</th>
                    <th>Promo</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                {% for application in applications %}
                    <tr class="application-row" data-application-id="{{ application.id }}">
                        <td>
                            <div class="student-info">
                                <div class="student-avatar">
                                    {{ application.student_name|first|upper }}
                                </div>
                                <div class="student-details">
                                    <h4>{{ application.student_name }}</h4>
                                    <p>{{ application.student_email }}</p>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="job-info">{{ application.job_title }}</div>
                            <div class="company-name">{{ application.contract_type }}</div>
                        </td>
                        <td>{{ application.company_name }}</td>
                        <td>
                            <div class="date-info">{{ application.applied_at|date('M d, Y') }}</div>
                        </td>
                        <td>
                            {% if application.status == 'pending' %}
                                <span class="status-badge status-pending">
                                    <i class="fas fa-clock"></i> {{ application.status }}
                                </span>
                            {% elseif application.status == 'accepted' %}
                                <span class="status-badge status-accepted">
                                    <i class="fas fa-check-circle"></i> {{ application.status }}
                                </span>
                            {% elseif application.status == 'rejected' %}
                                <span class="status-badge status-rejected">
                                    <i class="fas fa-times-circle"></i> {{ application.status }}
                                </span>
                            {% else %}
                                <span class="status-badge">{{ application.status }}</span>
                            {% endif %}
                        </td>
                        <td>{{ application.speciality ?? 'N/A' }}</td>
                        <td>{{ application.promo ?? 'N/A' }}</td>
                        <td>
                            {% if application.status == 'pending' %}
                                <button onclick="acceptApplication({{ application.id }})" class="action-btn accept-btn">
                                    <i class="fas fa-check"></i> Accept
                                </button>
                                <button onclick="rejectApplication({{ application.id }})" class="action-btn reject-btn">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            {% elseif application.status == 'accepted' or application.status == 'rejected' %}
                                <button onclick="resetApplication({{ application.id }})" class="action-btn reset-btn">
                                    <i class="fas fa-undo"></i> Reset to Pending
                                </button>
                            {% else %}
                                <span class="action-disabled">{{ application.status|title }}</span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <h2>No applications yet</h2>
            <p>Student applications will appear here once they start applying for job positions.</p>
        </div>
    {% endif %}
</div>

<!-- Modern Student Details Modal -->
<div id="studentModal" class="modal">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <div id="modal-body">
            <!-- Dynamic content will be injected here -->
        </div>
    </div>
</div>

{% include 'back/assets/footer.twig' %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('studentModal');
        const modalBody = document.getElementById('modal-body');
        const closeButton = document.querySelector('#studentModal .close-button');

        const applications = {{ applications|json_encode|raw }};
        const applicationsById = {};
        if (Array.isArray(applications)) {
            applications.forEach(app => {
                applicationsById[app.id] = app;
            });
        }

        document.querySelectorAll('.application-row').forEach(row => {
            row.style.cursor = 'pointer';
            row.addEventListener('click', function(event) {
                if (event.target.closest('a, button')) {
                    return;
                }

                const appId = this.dataset.applicationId;
                const app = applicationsById[appId];

                if (app) {
                    openApplicationModal(app);
                }
            });
        });

        function closeModal() {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        if(closeButton) {
            closeButton.addEventListener('click', closeModal);
        }

        window.addEventListener('click', function(event) {
            if (event.target == modal) {
                closeModal();
            }
        });

        window.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && modal.style.display === 'block') {
                closeModal();
            }
        });

        function openApplicationModal(app) {
            let statusIcon = 'fas fa-info-circle';
            if (app.status.toLowerCase().includes('pending')) statusIcon = 'fas fa-clock';
            if (app.status.toLowerCase().includes('accepted')) statusIcon = 'fas fa-check-circle';
            if (app.status.toLowerCase().includes('rejected')) statusIcon = 'fas fa-times-circle';

            modalBody.innerHTML = `
            <div class="modal-header">
                <div class="modal-header-content">
                    <div class="modal-avatar">
                        ${app.student_name.charAt(0).toUpperCase()}
                    </div>
                    <div class="modal-header-text">
                        <h3>${app.student_name}</h3>
                        <p>${app.student_email}</p>
                        <div class="badge-group">
                            <span class="modal-status">
                                <i class="${statusIcon}"></i>
                                ${app.status}
                            </span>
                            <span class="info-badge">
                                <i class="fas fa-graduation-cap"></i> ${app.promo || 'N/A'}
                            </span>
                            <span class="info-badge">
                                <i class="fas fa-code"></i> ${app.speciality || 'N/A'}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <div class="modal-grid">
                    <div class="modal-section">
                        <h4><i class="fas fa-user-graduate"></i> Student Information</h4>
                        <div class="info-grid">
                            <div class="info-label">Speciality:</div>
                            <div class="info-value">${app.speciality || 'N/A'}</div>

                            <div class="info-label">Promo:</div>
                            <div class="info-value">${app.promo || 'N/A'}</div>

                            <div class="info-label">Email:</div>
                            <div class="info-value">${app.student_email}</div>

                            <div class="info-label">Applied Date:</div>
                            <div class="info-value">${new Date(app.applied_at).toLocaleDateString()}</div>
                        </div>
                    </div>

                    <div class="modal-section">
                        <h4><i class="fas fa-briefcase"></i> Job Details</h4>
                        <div class="info-grid">
                            <div class="info-label">Position:</div>
                            <div class="info-value">${app.job_title}</div>

                            <div class="info-label">Company:</div>
                            <div class="info-value">${app.company_name}</div>

                            <div class="info-label">Contract Type:</div>
                            <div class="info-value">${app.contract_type}</div>

                            <div class="info-label">Status:</div>
                            <div class="info-value">${app.status}</div>
                        </div>
                    </div>

                    <div class="modal-section">
                        <h4><i class="fas fa-history"></i> Timeline</h4>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-date">${new Date(app.applied_at).toLocaleDateString()}</div>
                                <div class="timeline-content">Application submitted</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">Currently</div>
                                <div class="timeline-content">Status: ${app.status}</div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-section">
                        <h4><i class="fas fa-file-alt"></i> Documents</h4>
                        <div class="info-grid">
                            <div class="info-label">Resume:</div>
                            <div class="info-value">
                                ${app.cv_path ? `<a href="/JobDatingV2/public/${app.cv_path}" target="_blank" onclick="event.stopPropagation();">View CV <i class="fas fa-external-link-alt"></i></a>` : 'Not provided'}
                            </div>

                            <div class="info-label">LinkedIn:</div>
                            <div class="info-value">
                                <a href="#" target="_blank" onclick="event.stopPropagation();">
                                    View Profile <i class="fab fa-linkedin"></i>
                                </a>
                            </div>

                            <div class="info-label">Portfolio:</div>
                            <div class="info-value">
                                <a href="#" target="_blank" onclick="event.stopPropagation();">
                                    View Portfolio <i class="fas fa-external-link-alt"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-section">
                    <h4><i class="fas fa-envelope-open-text"></i> Motivation Letter</h4>
                    <div class="motivation-letter">
                        ${app.cover_letter || 'No motivation letter provided.'}
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                ${app.status === 'pending' ? `
                <button class="modal-btn modal-btn-accept" onclick="acceptApplication(${app.id})">
                    <i class="fas fa-check"></i> Accept Application
                </button>
                <button class="modal-btn modal-btn-reject" onclick="rejectApplication(${app.id})">
                    <i class="fas fa-times"></i> Reject Application
                </button>
                ` : (app.status === 'accepted' || app.status === 'rejected') ? `
                <button class="modal-btn modal-btn-reset" onclick="resetApplication(${app.id})" style="background: var(--color-warning); color: white;">
                    <i class="fas fa-undo"></i> Reset to Pending
                </button>
                ` : ''}
                <button class="modal-btn modal-btn-close" onclick="closeModal()">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        `;

            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            modal.focus();
        }

        window.closeModal = closeModal;
    });

    function acceptApplication(id) {
        if (confirm('Are you sure you want to accept this application?')) {
            fetch('/JobDatingV2/public/admin/applications/accept/' + id, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: 'csrf_token={{ csrf_token }}'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateApplicationStatus(id, data.status);
                    showNotification('Application accepted successfully', 'success');
                } else {
                    showNotification(data.message || 'Failed to accept application', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('An error occurred while processing your request', 'error');
            });
        }
    }

    function rejectApplication(id) {
        if (confirm('Are you sure you want to reject this application?')) {
            fetch('/JobDatingV2/public/admin/applications/reject/' + id, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: 'csrf_token={{ csrf_token }}'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateApplicationStatus(id, data.status);
                    showNotification('Application rejected successfully', 'success');
                } else {
                    showNotification(data.message || 'Failed to reject application', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('An error occurred while processing your request', 'error');
            });
        }
    }

    function resetApplication(id) {
        if (confirm('Are you sure you want to reset this application to pending status?')) {
            fetch('/JobDatingV2/public/admin/applications/reset/' + id, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: 'csrf_token={{ csrf_token }}'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateApplicationStatus(id, data.status);
                    showNotification('Application reset to pending successfully', 'success');
                } else {
                    showNotification(data.message || 'Failed to reset application', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('An error occurred while processing your request', 'error');
            });
        }
    }

    function updateApplicationStatus(id, newStatus) {
        const row = document.querySelector(`tr[data-application-id="${id}"]`);
        if (!row) return;

        // Update status badge
        const statusCell = row.querySelector('td:nth-child(5)');
        if (statusCell) {
            let statusHtml = '';
            if (newStatus === 'accepted') {
                statusHtml = '<span class="status-badge status-accepted"><i class="fas fa-check-circle"></i> accepted</span>';
            } else if (newStatus === 'rejected') {
                statusHtml = '<span class="status-badge status-rejected"><i class="fas fa-times-circle"></i> rejected</span>';
            } else if (newStatus === 'pending') {
                statusHtml = '<span class="status-badge status-pending"><i class="fas fa-clock"></i> pending</span>';
            }
            statusCell.innerHTML = statusHtml;
        }

        // Update actions cell
        const actionsCell = row.querySelector('td:nth-child(8)');
        if (actionsCell) {
            let actionsHtml = '';
            if (newStatus === 'pending') {
                actionsHtml = `
                    <button onclick="acceptApplication(${id})" class="action-btn accept-btn">
                        <i class="fas fa-check"></i> Accept
                    </button>
                    <button onclick="rejectApplication(${id})" class="action-btn reject-btn">
                        <i class="fas fa-times"></i> Reject
                    </button>
                `;
            } else if (newStatus === 'accepted' || newStatus === 'rejected') {
                actionsHtml = `
                    <button onclick="resetApplication(${id})" class="action-btn reset-btn">
                        <i class="fas fa-undo"></i> Reset to Pending
                    </button>
                `;
            } else {
                actionsHtml = `<span class="action-disabled">${newStatus.charAt(0).toUpperCase() + newStatus.slice(1)}</span>`;
            }
            actionsCell.innerHTML = actionsHtml;
        }

        // Update modal if open
        const modal = document.getElementById('studentModal');
        if (modal && modal.style.display === 'block') {
            const modalStatus = modal.querySelector('.modal-status');
            if (modalStatus) {
                let icon = 'fas fa-info-circle';
                if (newStatus === 'accepted') icon = 'fas fa-check-circle';
                if (newStatus === 'rejected') icon = 'fas fa-times-circle';
                if (newStatus === 'pending') icon = 'fas fa-clock';
                
                modalStatus.innerHTML = `<i class="${icon}"></i> ${newStatus}`;
            }

            // Update modal actions
            const modalActions = modal.querySelector('.modal-actions');
            if (modalActions) {
                let modalActionsHtml = '';
                if (newStatus === 'pending') {
                    modalActionsHtml = `
                        <button class="modal-btn modal-btn-accept" onclick="acceptApplication(${id})">
                            <i class="fas fa-check"></i> Accept Application
                        </button>
                        <button class="modal-btn modal-btn-reject" onclick="rejectApplication(${id})">
                            <i class="fas fa-times"></i> Reject Application
                        </button>
                    `;
                } else if (newStatus === 'accepted' || newStatus === 'rejected') {
                    modalActionsHtml = `
                        <button class="modal-btn modal-btn-reset" onclick="resetApplication(${id})" style="background: var(--color-warning); color: white;">
                            <i class="fas fa-undo"></i> Reset to Pending
                        </button>
                    `;
                }
                modalActionsHtml += `
                    <button class="modal-btn modal-btn-close" onclick="closeModal()">
                        <i class="fas fa-times"></i> Close
                    </button>
                `;
                modalActions.innerHTML = modalActionsHtml;
            }
        }

        // Update applications data
        if (applicationsById[id]) {
            applicationsById[id].status = newStatus;
        }
    }

    function showNotification(message, type) {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
            ${message}
        `;

        // Add styles
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            background: ${type === 'success' ? '#059669' : '#DC2626'};
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            animation: slideInRight 0.3s ease-out;
        `;

        // Add animation keyframes
        if (!document.querySelector('#notification-styles')) {
            const style = document.createElement('style');
            style.id = 'notification-styles';
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOutRight {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

        document.body.appendChild(notification);

        // Remove after 3 seconds
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease-out';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }
</script>
</body>
</html>